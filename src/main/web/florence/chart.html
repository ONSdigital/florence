<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Florence</title>
  <link href="/florence/css/third-party/c3.css" rel="stylesheet" type="text/css">
  <link href="/florence/css/third-party/responsive-tables.css" rel="stylesheet" type="text/css">
</head>
<body>

<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Chart</a></li>
    <li><a href="#tabs-2">Table</a></li>
  </ul>
  <div id="tabs-1">
    <p id="chart"></p>
  </div>
  <div id="tabs-2" style="overflow: scroll;">
    <p>
      <div>
        <table id="dataTable" class="responsive"></table>
      </div>
    </p>
  </div>
</div>


<!--<div id="chart"></div>-->

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/third-party/responsive-tables.js"></script>
<script type="text/javascript" src="js/third-party/d3.min.js"></script>
<script type="text/javascript" src="js/third-party/c3.js"></script>
<script type="text/javascript" src="js/third-party/pym.min.js"></script>
<script type="text/javascript" src="js/functions/_chartRenderer.js"></script>
<script type="text/javascript">

  (function () {

    var path = getParameterByName('path');
    //var baseUrl = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '');
    //var full = baseUrl + '/zebedee' + path + '.json';

    var chart;

    var $graphic = $('#chart');
    var pymChild = new pym.Child({});

    function drawGraphic() {
      //var margin = {top: 10, right: 15, bottom: 25, left: 35};
      var chartWidth = $graphic.width(); //- margin.left - margin.right;
      var chartHeight = chartWidth * chart.aspectRatio;

      console.log('render width: ' + chartWidth + ' height: ' + chartHeight);

      renderChartObject('#chart', chart, chartHeight, chartWidth);

      pymChild.sendHeight();
    }

    $.ajax({
      url: "/zebedee/content/" + getCookieValue('collection') + "?uri=" + path,
      type: "GET",
      success: function (data) {
        renderChartObject('#chart', data);
        drawTable(data);
        chart = data;
        drawGraphic();
        window.onresize = drawGraphic;
      }
    });

    function getCookieValue(a, b) {
      b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
      return b ? b.pop() : '';
    }

    function getParameterByName(name) {
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    function drawTable(data) {
      var title = data.headers;
      var rows = data.data;
      drawTitles(title);
      for (var i = 0; i < rows.length; i++) {
        drawRow(rows[i]);
      }

      function drawTitles(title) {
        var row = $("<tr />");
        $("#dataTable").append(row);
        for (var j = 0; j < title.length; j++) {
          row.append($("<th>" + title[j] + "</th>"));
        }
      }

      function drawRow(rowData) {
        var row = $("<tr />")
        $("#dataTable").append(row);
        for (var j = 0; j < title.length; j++) {
          row.append($("<td>" + rowData[title[j]] + "</td>"));
        }
      }
    }
  })();

</script>
</body>
</html>