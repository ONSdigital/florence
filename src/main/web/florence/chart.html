<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Florence</title>
  <link href="/florence/css/third-party/c3.css" rel="stylesheet" type="text/css">
</head>
<body>


<div id="chart"></div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/third-party/d3.min.js"></script>
<script type="text/javascript" src="js/third-party/c3.js"></script>
<script type="text/javascript" src="js/third-party/pym.min.js"></script>
<script type="text/javascript" src="js/functions/_chartRenderer.js"></script>
<script type="text/javascript">

  (function () {

    var path = getParameterByName('path');
    //var baseUrl = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '');
    //var full = baseUrl + '/zebedee' + path + '.json';

    var chart;

    var $graphic = $('#chart');
    var pymChild = new pym.Child({});

    function drawGraphic() {
      //var margin = {top: 10, right: 15, bottom: 25, left: 35};
      var chartWidth = $graphic.width(); //- margin.left - margin.right;
      var chartHeight = chartWidth * chart.aspectRatio;

      console.log('render width: ' + chartWidth + ' height: ' + chartHeight);

      renderChartObject('#chart', chart, chartHeight, chartWidth);

      pymChild.sendHeight();
    }

    $.ajax({
      url: "/zebedee/content/" + getCookieValue('collection') + "?uri=" + path,
      type: "GET",
      success: function (data) {
        chart = data;
        drawGraphic();
        window.onresize = drawGraphic;
      }
    });

    function getCookieValue(a, b) {
      b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
      return b ? b.pop() : '';
    }

    function getParameterByName(name) {
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

  })();

</script>
</body>
</html>